generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL") 
}

// User Model
model User {
  id               String  @id
  username         String
  discriminator    String
  email            String  @unique
  password         String
  token            String?
  avatar           String?
  status           String  @default("offline")
  bio              String?
  profile_banner   String?
  profile_theme    String? @default("holographic")
  isVerified       Boolean @default(false)
  verificationCode String?
  isPublic         Boolean @default(true)
  serverMembers    ServerMember[]

  @@map("users")
}

// Server Model
model Server {
  id                String   @id
  name              String
  ownerId           String
  description       String?
  banner            String?
  systemChannelId   String?
  verificationLevel Int      @default(0)
  avatar_default    String?
  avatar_active     String?
  isPublic          Boolean  @default(false)
  createdAt         BigInt?
  members           ServerMember[]
  channels          Channel[]
  roles             Role[]
  bans              ServerBan[]

  @@map("servers")
}

// ServerBan Model
model ServerBan {
  id         String   @id @default(uuid())
  serverId   String
  userId     String
  reason     String?
  executorId String
  createdAt  BigInt
  
  server     Server   @relation(fields: [serverId], references: [id], onDelete: Cascade)

  @@map("server_bans")
}

// Channel Model
model Channel {
  id        String  @id
  serverId  String
  name      String
  type      String
  position  Int     @default(0)
  isPrivate Boolean @default(false)
  slowMode  Int     @default(0) // Message cooldown in seconds (NEW)
  
  server    Server  @relation(fields: [serverId], references: [id], onDelete: Cascade)

  @@map("channels")
}

// ServerMember Model
model ServerMember {
  userId   String
  serverId String
  joinedAt BigInt?
  isMuted  Boolean @default(false) // Mute server notifications (NEW)
  
  server   Server   @relation(fields: [serverId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, serverId])
  @@map("server_members")
}

// Role Model
model Role {
  id          String  @id
  serverId    String
  name        String
  color       String?
  permissions String?
  position    Int?
  
  server      Server  @relation(fields: [serverId], references: [id], onDelete: Cascade)
  userRoles   UserRole[]

  @@map("roles")
}

// UserRole Model
model UserRole {
  userId String
  roleId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@map("user_roles")
}

// Invite Model
model Invite {
  id            String  @id
  code          String  @unique
  serverId      String
  channelId     String?
  authorId      String
  maxUses       Int?
  uses          Int     @default(0)
  expiresAt     BigInt?
  defaultRoleId String?
  temporary     Int     @default(0) 
  createdAt     BigInt?

  @@map("invites")
}

// Friend Model
model Friend {
  user1Id   String
  user2Id   String
  status    String  @default("pending")
  createdAt BigInt?

  @@id([user1Id, user2Id])
  @@map("friends")
}

// DirectMessage Model
model DirectMessage {
  id          String  @id
  senderId    String
  recipientId String
  content     String
  timestamp   BigInt
  read        Int     @default(0)
  attachments String? 

  @@map("direct_messages")
}

// ChannelMessage Model
model ChannelMessage {
  id           String  @id
  channelId    String
  authorId     String
  authorName   String
  authorAvatar String?
  content      String
  timestamp    BigInt
  attachments  String? 
  audioData    String?

  @@map("channel_messages")
}

// UserReadState Model
model UserReadState {
  userId            String
  channelId         String
  lastReadMessageId String?
  lastReadTimestamp BigInt?

  @@id([userId, channelId])
  @@map("user_read_states")
}

// Custom Themes Model
model Theme {
  id         String  @id
  name       String
  authorId   String
  authorName String
  config     String  
  isPublic   Boolean @default(true)
  createdAt  BigInt

  @@map("themes")
}